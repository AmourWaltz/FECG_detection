# FECG detection：

​		目前可以在之前的模型上成功检测到胎儿心跳，最佳准确率可达95%以上，虽然只是在小样本上进行，但无过拟合现象，理想情况下通过优化模型可以普遍达到这个检测率；现在把整个模型分为以下三个部分进行：**信号预处理，特征检测，特异性诊断（即引入主动学习的Patient Specific，后面有解释，中文名是我自己起的）。**

### term

* 正样本：截取的包含胎儿心拍且胎儿QRS波在中间位置的片段；负样本：在距离胎儿QRS波一定距离截取的等长度背景片段。
* 假阴性率：含胎儿心拍片段判断为背景片段；假阳性率：背景片段判断为胎儿心拍片段。
* 心拍：心电信号中同时包含母体和胎儿的心拍，如无特殊说明，以下所提及的心拍均为胎儿心拍。
* 个体样本：指一次输入到模型的patients数量，数据集仍采用之前的包含75个patients，每人一分钟心电信号大约包含130个胎儿心拍的数据集。
* 类内特征：来自同一个体的心拍特征集合；类间特征：不同个体间的心拍特征。



## 信号预处理

​	利用独立成分分析，小波变换方法等传统方法，去除工频噪声，基线漂移，肌电噪声，母体信号等的干扰，同时保证FECG不失真，使接下来的神经网络能准确学习并提取FECG的特征。

### Schedule

* 1.1-1.9，使用小波变换过滤基线漂移，肌电噪声，工频噪声等。

### Problem

* 应用小波变换后（db2,6,8），收敛加快，但准确率略微下降。**大致是因为去噪的同时导致胎儿信号有所失真，可学习的特征减少，有些得不偿失。**小波去噪的输出信号有截图，可看出去噪效果，但应该一定程度上导致FECG失真。接下来可以试试其他小波基函数以及调整阈值使得去噪的同时尽量保证信号不失真。
* 胎儿QRS波附加在母体QRS波上的情况，深度学习框架无能为力，具体表现在假阴性率总是大于假阳性率，输出相关片段发现均为误识别。**目前想到只能通过传统方法尽可能减弱母体信号幅值，或根据先验知识在输出片段中进行补充（这就需要确保胎儿心跳无室性早搏等异常）。**
* 针对上述问题，由于卷积网络的抗噪能力比较可观，**信号预处理应当把抵消母体成分的干扰作为重点**。针对小波分析的特点，似乎不是解决该问题的最佳选择，**下一阶段决定尝试独立成分分析抵消母体干扰。**



## 2.特征检测

​		以CNN，RNN为基本模型提取并检测心拍特征，再利用滑动窗口+非极大抑制的目标检测框架定位所有心拍，即可进行心拍截取、心率计算及进一步的诊断分析。

### Schedule

* 1.1-1.9，以一维CNN和LSTM为基础模型，尝试ResNet，TCN，Bi-LSTM等优化模型，取得一定效果。解决了之前学习不到特征的问题后，测试表明一维CNN在局部特征提取，收敛速度，训练模型占用内存等各方面均优于LSTM，所以把一维CNN作为基础模型在此基础上尝试优化。

### Problem

* 学习能力断层：即刚开始检测胎儿信号时学习不到任何特征的现象，先后使用加长片段，小波去噪，优化网络，改变样本分布等方法，只有减少个体样本数量后明显解决，一次输入过多的个体会导致训练性能下降甚至完全学不到特征。当输入大于45个个体就会发生上述学习能力丧失的情况，而小于40个个体时即可正常学习，**并且未发生过拟合；**一次输入10个个体然后用10个别的个体测试，准确率可达95%以上，感觉似乎是模型学习能力有限，**一些测试结果表明并非是个体数量增加引起的学习能力丧失，一次输入的个体数量与每个个体的心拍数量，即类间特征与类内特征存在某种关系会影响模型学习能力，一次输入40个病人个体每人截取130个心拍可以正常学习，但如果每人只截取60个心拍也会无法学习，关于这个问题，目前想到通过下一步的主动学习方法解决**。
* 网络结构改复杂（CNN增加深度，RNN增加隐藏单元数，甚至用1D-ResNet18），分类准确率基本无变化。**是因为特征有限，复杂网络并不能解决？还是易陷入局部最优？还是梯度消失？**
* 最佳截取长度：截取长度为预测R-R间隔的60%表现较差，改为75%后分类性能有所上升。本意是想包含PQRST波即可，但就测试结果来看截取长度对负样本判别能力也会影响。**目前只能想到通过不断调参找到最优片段长度。**
* 正负样本比例：正负样本1：1时，假阴性率总是大于假阳性率。增加负样本比重至正：负=1：3，可明显提高检测准确率。私以为胎儿心跳片段特征有限，网络模型倾向于把背景片段的特征也学习，而背景片段特征远多于心跳片段，因此在样本不够时部分特征无法学习，以至于增加误判，检测问题而非分类问题，应该慎重考虑正负样本制作。 **除了增加负样本比重外，还可借鉴Fast-CNN模型，考虑引入GAN生成对抗样本？**2019 CVPR有一篇GAN做图像目标检测样本的文章，正在看。
* 今天尝试了一个TCN模型，就是个扩张卷积+跳层连接+因果卷积的模型，效果不理想还在改进。实际上五层一维CNN基础框架就可以达到95%以上的检测准确率了，所以模型不想搞得太复杂，**下阶段计划在原来网络基础上，逐一引入inception，跳层连接，扩张卷积，LSTM，attention等模块看表现如何，最后构建一个最优模型。因为是对信号做卷积，觉得可以把卷积网络以及以上模块处理信号序列的性能解释也作为文章的一个点，一些深度学习处理信号序列的文章也只是文字描述可行性，我想尽可能针对我的模型引入一些数学证明，不知道是否可行？**



## 3.特异性诊断（Patient Specific）

* 考虑病人个体之间存在差异，引入主动学习模型，尽可能做到对每个病人有特定的诊断模型，同时也能解决特征检测阶段对较多个体样本无法学习的问题。
* 最理想：Inter-Patient，严格遵守训练集和测试集数据来自不同病人的规定，与实际应用场景最为符合，但是个体差异性带来的消极影响最大，实现难度最大。
* 最容易：Intra-Patient，完全不考虑个体差异性问题，训练集和测试集可以来自同一个病人，甚至刻意促成这一点，以达到更高的性能。此时，个体差异性带来的消极影响最小，实现难度最小。
* 这两者中间的折衷方案，就是Patient-Specific。这里的训练集分为全局训练集和个体训练集，全局训练集和测试集来自不同的病人。用全局训练集训练一个分类器，在遇到一个新病人时，不是直接预测，而是将新病人的一小部分数据打上标签（可以理解为“偷看”标签），作为个体训练集来对分类器作微调训练，然后预测剩下的数据。

### Schedule

* 1.1-1.9，学习了主动学习的理论知识，按以下方式做了简单尝试：用20个个体训练好基础模型，对于新引入的一个测试个体，取其前十个心拍（每个个体有约130个的心拍）输入模型进行有监督学习（此处只是验证主动学习模型的可行性，并未考虑专家诊断，所以直接把已知标签作为专家诊断结果），微调模型，然后预测剩下的心拍片段，这样测试20个体，准确率可达91%以上，接近训练集的准确率（原始方法输入20个个体作训练集20个作测试集，准确率约为80%，并且只用少量个体训练即可，不用担心学习力丧失的问题），证明引入主动学习的可行性。

### Problem

* 用之前方法相当于把类间特征与类内特征同时在一个模型里学习，因此效果较差，引入主动学习相当于把类间特征与类内特征分开学习，因此效果较为理想。
* 这部分刚开始着手，还在看论文，暂时没什么有价值的问题。不过这部分想要重点探索，理想能构造这样一个模型：训练阶段就把病人分开，每个病人用个性化模型输出为一系列类内特征，再把这些类内特征放到一起寻找类间特征。对于新输入的一个个体，用个性化模型输出类内特征后，结合之前的类间特征和专家诊断做特异性诊断。大致想法如此，模糊之处甚多，接下来需参考相关文献使其可行，**主要思想还是把类内特征和类间特征分开检测。**



## Summary：

* 我感觉文章的思路差不多就这样，既有传统方法也有深度学习。国外传统方法检测FECG的文章挺多的，效果貌似也都挺好，所以我感觉重点应该是主动学习解决patient-specific，预处理阶段应该改进传统方法使其处理后的信号能最佳适应深度学习模型，特征检测应该重点关注模型的可解释性。上述特征检测和主动学习处理FECG的模型没找到任何之前相关的文章，可以照着当前思路进行。学姐是否还有什么建议？
* 下一阶段主要解决以下四个问题：1.引入独立成分分析解决母体成分抵消；2.引入GAN网络生成负样本测试效果；3.改进特征提取的网络模型，增加可解释性；4.完善主动学习框架解决patient-specific。
* 还有个疑问，最近看的文章似乎没有发表在朱老师上次发的heart和arrhythmia两个杂志上的，因为我现在整体思路是侧重深度学习的，这两个医学杂志会不会对深度学习的文章不太感兴趣？感觉医学界对深度学习这种黑盒模型应该挺忌讳的，所以我才想在特征检测那块侧重模型可解释性描述与证明。

